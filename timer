#! /usr/bin/python3

from statistics import median
import numpy as np
import pandas as pd
import argparse
import subprocess

TIMES = 7


parser = argparse.ArgumentParser(description='.')

parser.add_argument('-j', '--java', type=str, nargs="+" , required=True)
parser.add_argument("-a", '--args', type=str, nargs="+")

args = parser.parse_args()

bins = vars(args).get("java")
argList = vars(args).get("args")
out = np.zeros((len(bins), len(argList)))
speedup = np.zeros((len(bins), len(argList)-1))

x = 0
y = 0

for bin in bins: 
    for arg in argList:
        command = "java -Xmx6000m " + bin + " " + arg
        time = subprocess.check_output(command.split(), stderr=subprocess.PIPE)
        time = (str(time)[2:len(str(time))-3])
        time = str(time).split('\\n')
        time.sort()
        out[x, y] = float(time[3])/1000
        if y == 0:
            basetime = time[3]
        else:
            speedup[x, y-1] = basetime/time[3]
        y = y + 1
        print(bin, arg)
    y = 0
    x = x + 1


df = pd.DataFrame(out, bins, argList)
df.to_excel("results.xlsx")

argList.pop(0)

df = pd.DataFram(speedup, bins, argList)
df.to_excel("results.xlsx", sheet_name="Speedup")

print("Results.xlsx is create : )")

